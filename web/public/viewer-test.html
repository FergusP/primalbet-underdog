<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Arena Viewer Test Interface</title>
  <style>
    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
    }

    body {
      font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
      background: linear-gradient(135deg, #1a1a2e 0%, #16213e 100%);
      color: #fff;
      padding: 20px;
      min-height: 100vh;
    }

    .container {
      max-width: 600px;
      margin: 0 auto;
    }

    h1 {
      text-align: center;
      margin-bottom: 10px;
      color: #00d9ff;
      text-shadow: 0 0 10px rgba(0, 217, 255, 0.5);
    }

    .subtitle {
      text-align: center;
      color: #888;
      margin-bottom: 30px;
      font-size: 14px;
    }

    .status-card {
      background: rgba(255, 255, 255, 0.05);
      border: 1px solid rgba(255, 255, 255, 0.1);
      border-radius: 12px;
      padding: 20px;
      margin-bottom: 20px;
    }

    .status-row {
      display: flex;
      justify-content: space-between;
      margin-bottom: 10px;
    }

    .status-label {
      color: #888;
    }

    .status-value {
      font-weight: bold;
      color: #00d9ff;
    }

    .wallet-input {
      width: 100%;
      padding: 12px;
      background: rgba(255, 255, 255, 0.05);
      border: 1px solid rgba(255, 255, 255, 0.2);
      border-radius: 8px;
      color: #fff;
      font-size: 14px;
      margin-bottom: 20px;
    }

    .wallet-input:focus {
      outline: none;
      border-color: #00d9ff;
      box-shadow: 0 0 0 2px rgba(0, 217, 255, 0.2);
    }

    .packages {
      display: grid;
      gap: 15px;
    }

    .package-card {
      background: rgba(255, 255, 255, 0.05);
      border: 2px solid rgba(255, 255, 255, 0.1);
      border-radius: 12px;
      padding: 20px;
      cursor: pointer;
      transition: all 0.3s ease;
      position: relative;
      overflow: hidden;
    }

    .package-card:hover {
      transform: translateY(-2px);
      border-color: rgba(255, 255, 255, 0.3);
      box-shadow: 0 5px 20px rgba(0, 0, 0, 0.3);
    }

    .package-card.health {
      border-color: rgba(0, 255, 0, 0.3);
    }

    .package-card.health:hover {
      background: rgba(0, 255, 0, 0.1);
      border-color: rgba(0, 255, 0, 0.6);
    }

    .package-card.damage {
      border-color: rgba(255, 100, 0, 0.3);
    }

    .package-card.damage:hover {
      background: rgba(255, 100, 0, 0.1);
      border-color: rgba(255, 100, 0, 0.6);
    }

    .package-card.monster {
      border-color: rgba(138, 43, 226, 0.3);
    }

    .package-card.monster:hover {
      background: rgba(138, 43, 226, 0.1);
      border-color: rgba(138, 43, 226, 0.6);
    }

    .package-header {
      display: flex;
      align-items: center;
      gap: 10px;
      margin-bottom: 10px;
    }

    .package-icon {
      font-size: 32px;
    }

    .package-name {
      font-size: 20px;
      font-weight: bold;
    }

    .package-description {
      color: #aaa;
      margin-bottom: 10px;
      font-size: 14px;
    }

    .package-footer {
      display: flex;
      justify-content: space-between;
      align-items: center;
    }

    .package-cost {
      color: #ffd700;
      font-weight: bold;
    }

    .package-effect {
      color: #888;
      font-size: 12px;
    }

    .feedback {
      position: fixed;
      bottom: 20px;
      right: 20px;
      background: rgba(0, 217, 255, 0.9);
      color: #000;
      padding: 15px 20px;
      border-radius: 8px;
      font-weight: bold;
      opacity: 0;
      transform: translateY(20px);
      transition: all 0.3s ease;
      pointer-events: none;
      max-width: 300px;
      box-shadow: 0 5px 20px rgba(0, 0, 0, 0.5);
    }

    .feedback.show {
      opacity: 1;
      transform: translateY(0);
    }

    .feedback.error {
      background: rgba(255, 0, 0, 0.9);
      color: #fff;
    }

    .feedback.success {
      background: rgba(0, 255, 0, 0.9);
      color: #000;
    }

    @keyframes pulse {
      0%, 100% { transform: scale(1); }
      50% { transform: scale(1.05); }
    }

    .package-card:active {
      animation: pulse 0.3s ease;
    }
  </style>
</head>
<body>
  <div class="container">
    <h1>🎮 Arena Viewer Test Interface</h1>
    <p class="subtitle">Simulate viewer package purchases</p>

    <div class="status-card">
      <h3 style="margin-bottom: 15px;">Arena Status</h3>
      <div class="status-row">
        <span class="status-label">Backend:</span>
        <span class="status-value" id="backend-status">Connecting...</span>
      </div>
      <div class="status-row">
        <span class="status-label">Player Wallet:</span>
        <span class="status-value" id="player-wallet">Not set</span>
      </div>
    </div>

    <input
      type="text"
      class="wallet-input"
      id="wallet-input"
      placeholder="Enter player wallet address to test with..."
    >

    <div class="packages">
      <div class="package-card health" data-package-id="69008ee1eb39e74d32d2fb08" data-package-name="Health Potion">
        <div class="package-header">
          <div class="package-icon">🧪</div>
          <div class="package-name">Health Potion</div>
        </div>
        <div class="package-description">
          Restores 20 HP to the player. Perfect for clutch moments!
        </div>
        <div class="package-footer">
          <div class="package-cost">💰 50 Arena Coins</div>
          <div class="package-effect">+20 HP</div>
        </div>
      </div>

      <div class="package-card damage" data-package-id="69008f47eb39e74d32d2fce8" data-package-name="Damage Boost">
        <div class="package-header">
          <div class="package-icon">🔥</div>
          <div class="package-name">Damage Boost</div>
        </div>
        <div class="package-description">
          Doubles player damage output for 10 seconds. Help crush the monster!
        </div>
        <div class="package-footer">
          <div class="package-cost">💰 50 Arena Coins</div>
          <div class="package-effect">2x DMG</div>
        </div>
      </div>

      <div class="package-card monster" data-package-id="69008fb8eb39e74d32d2fd14" data-package-name="Monster Heal">
        <div class="package-header">
          <div class="package-icon">💚</div>
          <div class="package-name">Monster Heal</div>
        </div>
        <div class="package-description">
          Heals the monster for 50 HP. Troll mode activated! 😈
        </div>
        <div class="package-footer">
          <div class="package-cost">💰 25 Arena Coins</div>
          <div class="package-effect">+50 HP (Monster)</div>
        </div>
      </div>
    </div>
  </div>

  <div class="feedback" id="feedback"></div>

  <script>
    const BACKEND_URL = 'http://localhost:3001/api';
    const walletInput = document.getElementById('wallet-input');
    const playerWalletDisplay = document.getElementById('player-wallet');
    const backendStatus = document.getElementById('backend-status');
    const feedback = document.getElementById('feedback');

    // Check backend status
    async function checkBackend() {
      try {
        const response = await fetch(`${BACKEND_URL}/health`);
        if (response.ok) {
          backendStatus.textContent = 'Connected ✅';
          backendStatus.style.color = '#00ff00';
        } else {
          backendStatus.textContent = 'Error ❌';
          backendStatus.style.color = '#ff0000';
        }
      } catch (error) {
        backendStatus.textContent = 'Offline ❌';
        backendStatus.style.color = '#ff0000';
      }
    }

    // Update wallet display
    walletInput.addEventListener('input', () => {
      const wallet = walletInput.value.trim();
      if (wallet) {
        playerWalletDisplay.textContent = wallet.slice(0, 8) + '...' + wallet.slice(-8);
      } else {
        playerWalletDisplay.textContent = 'Not set';
      }
    });

    // Show feedback toast
    function showFeedback(message, type = 'info') {
      feedback.textContent = message;
      feedback.className = `feedback show ${type}`;

      setTimeout(() => {
        feedback.classList.remove('show');
      }, 3000);
    }

    // Send package to backend
    async function sendPackage(packageId, packageName) {
      const wallet = walletInput.value.trim();

      if (!wallet) {
        showFeedback('⚠️ Please enter a player wallet address first!', 'error');
        return;
      }

      try {
        const response = await fetch(`${BACKEND_URL}/arena/package`, {
          method: 'POST',
          headers: {
            'Content-Type': 'application/json',
          },
          body: JSON.stringify({
            playerWallet: wallet,
            packageId: packageId,
            packageName: packageName,
          }),
        });

        const data = await response.json();

        if (data.success) {
          showFeedback(`✅ ${packageName} sent to player!`, 'success');
        } else {
          showFeedback(`❌ Failed: ${data.error || 'Unknown error'}`, 'error');
        }
      } catch (error) {
        showFeedback(`❌ Network error: ${error.message}`, 'error');
      }
    }

    // Handle package clicks
    document.querySelectorAll('.package-card').forEach(card => {
      card.addEventListener('click', () => {
        const packageId = card.getAttribute('data-package-id');
        const packageName = card.getAttribute('data-package-name');
        sendPackage(packageId, packageName);
      });
    });

    // Initial backend check
    checkBackend();
    setInterval(checkBackend, 5000);
  </script>
</body>
</html>
